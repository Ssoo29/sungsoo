--1
CREATE TABLE TB_CATEGORY
( NAME VARCHAR2(10),
  USE_YN CHAR(1) DEFAULT 'Y'
);

SELECT * FROM TB_CATEGORY;

--2
CREATE TABLE TB_CLASS_TYPE
(   NO VARCHAR2(5) PRIMARY KEY,
    NAME VARCHAR2(10)
);

SELECT * FROM TB_CLASS_TYPE;

--3
ALTER TABLE TB_CATEGORY
ADD PRIMARY KEY(NAME);

DESC TB_CATEGORY;

--4
ALTER TABLE TB_CLASS_TYPE
MODIFY NAME NOT NULL;

DESC TB_CLASS_TYPE;

--5
ALTER TABLE TB_CATEGORY
MODIFY NAME VARCHAR(20);

ALTER TABLE TB_CLASS_TYPE
MODIFY NO VARCHAR2(10);

--6
ALTER TABLE TB_CATEGORY
RENAME COLUMN NAME TO CATEGORY_NAME;

ALTER TABLE TB_CLASS_TYPE
RENAME COLUMN NO TO CLASS_TYPE_NO;


ALTER TABLE TB_CLASS_TYPE
RENAME COLUMN CLASS_TYPE_NO TO NAME;


--7
ALTER TABLE TB_CATEGORY
RENAME COLUMN CATEGORY_NAME TO PK_CATEGORY_NAME;

ALTER TABLE TB_CLASS_TYPE
RENAME COLUMN CLASS_TYPE_NO TO PK_CLASS_TYPE_NO;


--8
INSERT INTO TB_CATEGORY
VALUES('공학', 'Y');
INSERT INTO TB_CATEGORY VALUES ('자연과학','Y');
INSERT INTO TB_CATEGORY VALUES ('의학','Y');
INSERT INTO TB_CATEGORY VALUES ('예체능','Y');
INSERT INTO TB_CATEGORY VALUES ('인문사회','Y');

SELECT * FROM TB_CATEGORY;
COMMIT;

--9
ALTER TABLE TB_DEPARTMENT
ADD CONSTRAINT FK_DEPARTMENT FOREIGN KEY (CATEGORY) REFERENCES TB_CATEGORY(PK_CATEGORY_NAME);


--10
CREATE OR REPLACE VIEW VW_학생일반정보
AS SELECT STUDENT_NO, STUDENT_NAME, STUDENT_ADDRESS
    FROM TB_STUDENT;

--11
CREATE VIEW VW_지도면담
AS SELECT STUDENT_NAME 학생이름, DEPARTMENT_NAME 학과이름, PROFESSOR_NAME 지도교수이름
   FROM TB_STUDENT
   LEFT JOIN TB_DEPARTMENT USING(DEPARTMENT_NO)
   LEFT JOIN TB_PROFESSOR ON (COACH_PROFESSOR_NO = PROFESSOR_NO)
   ORDER BY DEPARTMENT_NAME;

SELECT * FROM VW_지도면담;

--12
CREATE VIEW VW_학과별학생수
AS SELECT DEPARTMENT_NAME, COUNT(*) STUDENT_COUNT
    FROM TB_STUDENT
    JOIN TB_DEPARTMENT USING(DEPARTMENT_NO)
    GROUP BY DEPARTMENT_NO, DEPARTMENT_NAME;


--13
--CREATE OR REPLACE VIEW VW_학생일반정보
--AS
--SELECT STUDENT_NO, STUDENT_NAME, STUDENT_ADDRESS
--FROM TB_STUDENT
--WHERE STUDENT_NO = 'A213046';
--
SELECT * FROM VW_학생일반정보;
--
--INSERT INTO VW_학생일반정보(STUDENT_NAME, STUDENT_NO, STUDENT_ADDRESS)
--VALUES('A213046', '김성수', '경기도 군포시 산본동 1052번지 대림아파트 724-301호');
UPDATE VW_학생일반정보
SET STUDENT_NAME = '김성수'
WHERE STUDENT_NO = 'A213046';

--14
CREATE OR REPLACE VIEW VW_학생일반정보
AS SELECT STUDENT_NO, STUDENT_NAME, STUDENT_ADDRESS
    FROM TB_STUDENT
   WITH READ ONLY;
    
UPDATE VW_학생일반정보
SET STUDENT_NAME = '김성수'
WHERE STUDENT_NO = 'A213046';


--15 2006년부터 2009년까지
SELECT CLASS_NO 과목번호, DEPARTMENT_NAME 과목이름, CNT 누적수강생수
FROM (SELECT CLASS_NO, COUNT(*) CNT
      FROM TB_GRADE
      WHERE SUBSTR(TERM_NO, 1, 4) BETWEEN '2006' AND '2009'
      GROUP BY CLASS_NO
      ORDER BY 2 DESC) INLV 
JOIN TB_CLASS USING(CLASS_NO)
JOIN TB_DEPARTMENT USING(DEPARTMENT_NO)
WHERE ROWNUM <= 3
ORDER BY 3 DESC, 1;



--DML***************************


--1
 SELECT * FROM TB_CLASS_TYPE;
 
 ALTER TABLE TB_CLASS_TYPE
 MODIFY ( NO VARCHAR2(10), NAME VARCHAR2(20));
 
 
 INSERT INTO TB_CLASS_TYPE(NO, NAME)
 VALUES('01', '전공필수');
 INSERT INTO TB_CLASS_TYPE(NO, NAME)
 VALUES('02', '전공선택');
  INSERT INTO TB_CLASS_TYPE(NO, NAME)
 VALUES('03', '고양필수');
  INSERT INTO TB_CLASS_TYPE(NO, NAME)
 VALUES('04', '교양선택');
  INSERT INTO TB_CLASS_TYPE(NO, NAME)
 VALUES('05', '논문지도');

 
 --2
 CREATE TABLE TB_학생일반정보
 AS 
 SELECT STUDENT_NO 학번, STUDENT_NAME 학생이름, STUDENT_ADDRESS 주소
 FROM TB_STUDENT;
 
 SELECT * FROM TB_학생일반정보;
 
 --3
 CREATE TABLE TB_국어국문학과
 AS
 SELECT STUDENT_NO 학번, STUDENT_NAME 학생이름, TO_CHAR(TO_DATE(SUBSTR(STUDENT_SSN, 1, 2), 'RR'), 'RRRR') 출생년도, PROFESSOR_NAME 교수이름
 FROM TB_STUDENT
 JOIN TB_PROFESSOR ON (COACH_PROFESSOR_NO = PROFESSOR_NO);
 
 SELECT * FROM TB_국어국문학과;
 DROP TABLE TB_국어국문학과;
 
 --4
UPDATE TB_DEPARTMENT
 SET CAPACITY = ROUND(CAPACITY + (CAPACITY * 0.1), 0);
 ROLLBACK;
 
SELECT * FROM TB_DEPARTMENT;


--5
UPDATE TB_STUDENT
 SET STUDENT_ADDRESS = '서울시 종로구 숭인동 181-21'
    WHERE STUDENT_NO = 'A413042';
    
SELECT * FROM TB_STUDENT WHERE STUDENT_NAME = '박건우';
        
--6
UPDATE TB_STUDENT
 SET STUDENT_SSN = SUBSTR(STUDENT_SSN, 1, 6);
 
 SELECT * FROM TB_STUDENT;
ROLLBACK;

--7
UPDATE TB_GRADE
SET POINT = 3.5
WHERE TERM_NO = '200501'AND STUDENT_NO = (SELECT STUDENT_NO 
                   FROM TB_STUDENT
                 LEFT JOIN TB_DEPARTMENT USING(DEPARTMENT_NO)
                 LEFT JOIN TB_CLASS USING(DEPARTMENT_NO)
                  WHERE CLASS_NAME = '피부생리학' AND DEPARTMENT_NAME = '의학과' AND
                  STUDENT_NAME = '김명훈');
ROLLBACK;
-- WHERE STUDENT_NO = (SELECT STUDENT_NO
--                     FROM TB_STUDENT
--                     WHERE STUDENT_NAME = '김명훈' AND DEPARTMENT_NO = (SELECT DEPARTMENT_NO
--                                             FROM TB_DEPARTMENT
--                                            WHERE DEPARTMENT_NAME = '의학과'))
--        AND TERM_NO = '200501' AND CLASS_NO = (SELECT CLASS_NO
--                                                FROM TB_CLASS
--                                                WHERE CLASS_NAME = '피부생리학');
--       
--8
DELETE FROM TB_GRADE
WHERE STUDENT_NO IN (SELECT STUDENT_NO
                    LEFT FROM TB_STUDENT
                    WHERE ABSENCE_YN = 'Y');
                    
 ROLLBACK;
